{"docs":[{"location":"appendix-01/index.html","text":"","title":"附录 1"},{"location":"appendix-01/index.html#附录-1","text":"TODO","title":"附录 1"},{"location":"index.html","text":"目录 第1章——Exploring Scala 第7章——特质 第8章——集合 第9章——模式匹配和正则表达式 第10章——处理异常 第11章——递归编程 第12章——惰性求值和并行集合 第13章——使用Actor模型处理并发 第14章——和Java进行互操作 第15章——使用Scala创建应用程序 第16章——单元测试\n《Scala 实用指南》\n一本写给Java开发者的Scala快速入门书。","title":""},{"location":"contents.html","text":"","title":"目录 ·"},{"location":"contents.html#目录","text":"","title":"目录"},{"location":"chapter-01/index.html","text":"","title":"第1章——Exploring Scala ·"},{"location":"chapter-01/index.html#第1章-exploring-scala","text":"","title":"第1章——Exploring Scala"},{"location":"chapter-01/index.html#代码清单1-1","text":"val symbols = List(\"AMD\", \"AAPL\", \"AMZN\", \"IBM\", \"ORCL\", \"MSFT\")\nval year = 2014\n\nval (topStock, topPrice) =\n  symbols.map { ticker ⇒ (ticker, getYearEndClosingPrice(ticker, year)) }\n    .maxBy { stockPrice ⇒ stockPrice._2 }\n\nprintf(s\"Top stock of $year is $topStock closing at price $$$topPrice\")","title":"代码清单1-1"},{"location":"chapter-01/index.html#代码清单1-2","text":"def getYearEndClosingPrice(symbol: String, year: Int) = {\n  val url = s\"http://ichart.finance.yahoo.com/table.csv?s=\" +\n    s\"$symbol&a=11&b=01&c=$year&d=11&e=31&f=$year&g=m\"\n\n  val data = io.Source.fromURL(url).mkString\n  val price = data.split(\"\\n\")(1).split(\",\")(4).toDouble\n  price\n}","title":"代码清单1-2"},{"location":"chapter-07/index.html","text":"","title":"第7章——特质 ·"},{"location":"chapter-07/index.html#第7章-特质","text":"","title":"第7章——特质"},{"location":"chapter-07/index.html#代码清单7-1","text":"class Human(val name: String) {\n  def listen(): Unit = println(s\"Your friend $name is listening\")\n}\n\nclass Man(override val name: String) extends Human(name)\nclass Woman(override val name: String) extends Human(name)","title":"代码清单7-1"},{"location":"chapter-07/index.html#代码清单7-2","text":"trait Friend {\n  val name: String\n  def listen(): Unit = println(s\"Your friend $name is listening\")\n}","title":"代码清单7-2"},{"location":"chapter-07/index.html#代码清单7-3","text":"class Human(val name: String) extends Friend\n\nclass Woman(override val name: String) extends Human(name)\nclass Man(override val name: String) extends Human(name)","title":"代码清单7-3"},{"location":"chapter-07/index.html#代码清单7-4","text":"class Dog(val name: String) extends Animal with Friend {\n  //optionally override method here.\n  override def listen(): Unit = println(s\"$name's listening quietly\")\n}","title":"代码清单7-4"},{"location":"chapter-07/index.html#代码清单7-5","text":"class Animal","title":"代码清单7-5"},{"location":"chapter-07/index.html#代码清单7-6","text":"object UseFriend extends App {\n  val john = new Man(\"John\")\n  val sara = new Woman(\"Sara\")\n  val comet = new Dog(\"Comet\")\n\n  john.listen()\n  sara.listen()\n  comet.listen()\n\n  val mansBestFriend: Friend = comet\n  mansBestFriend.listen()\n\n  def helpAsFriend(friend: Friend): Unit = friend.listen()\n\n  helpAsFriend(sara)\n  helpAsFriend(comet)\n}","title":"代码清单7-6"},{"location":"chapter-07/index.html#代码清单7-7","text":"class Cat(val name: String) extends Animal","title":"代码清单7-7"},{"location":"chapter-07/index.html#代码清单7-8","text":"object UseCat extends App {\n  def useFriend(friend: Friend): Unit = friend.listen()\n\n  val alf = new Cat(\"Alf\")\n  val friend: Friend = alf // ERROR\n\n  useFriend(alf) // ERROR\n}","title":"代码清单7-8"},{"location":"chapter-07/index.html#代码清单7-9","text":"def useFriend(friend: Friend): Unit = friend.listen()\n\nval angel = new Cat(\"Angel\") with Friend\nval friend: Friend = angel\nangel.listen()\n\nuseFriend(angel)","title":"代码清单7-9"},{"location":"chapter-07/index.html#代码清单7-10","text":"abstract class Check {\n  def check: String = \"Checked Application Details...\"\n}","title":"代码清单7-10"},{"location":"chapter-07/index.html#代码清单7-11","text":"trait CreditCheck extends Check {\n  override def check: String = s\"Checked Credit... ${super.check}\"\n}\n\ntrait EmploymentCheck extends Check {\n  override def check: String = s\"Checked Employment...${super.check}\"\n}\n\ntrait CriminalRecordCheck extends Check {\n  override def check: String = s\"Check Criminal Records...${super.check}\"\n}","title":"代码清单7-11"},{"location":"chapter-07/index.html#代码清单7-12","text":"val apartmentApplication =\n  new Check with CreditCheck with CriminalRecordCheck\n\nprintln(apartmentApplication.check)","title":"代码清单7-12"},{"location":"chapter-07/index.html#代码清单7-13","text":"val employmentApplication =\n  new Check with CriminalRecordCheck with EmploymentCheck\n\nprintln(employmentApplication.check)","title":"代码清单7-13"},{"location":"chapter-07/index.html#代码清单7-14","text":"abstract class Writer {\n  def writeMessage(message: String): Unit\n}","title":"代码清单7-14"},{"location":"chapter-07/index.html#代码清单7-15","text":"trait UpperCaseWriter extends Writer {\n  abstract override def writeMessage(message: String): Unit =\n    super.writeMessage(message.toUpperCase)\n}\n\ntrait ProfanityFilteredWriter extends Writer {\n  abstract override def writeMessage(message: String): Unit =\n    super.writeMessage(message.replace(\"stupid\", \"s-----\"))\n}","title":"代码清单7-15"},{"location":"chapter-07/index.html#代码清单7-16","text":"class StringWriterDelegate extends Writer {\n  val writer = new java.io.StringWriter\n\n  def writeMessage(message: String): Unit = writer.write(message)\n  override def toString: String = writer.toString\n}","title":"代码清单7-16"},{"location":"chapter-07/index.html#代码清单7-17","text":"val myWriterProfanityFirst =\n  new StringWriterDelegate with UpperCaseWriter with ProfanityFilteredWriter\n\nval myWriterProfanityLast =\n  new StringWriterDelegate with ProfanityFilteredWriter with UpperCaseWriter\n\nmyWriterProfanityFirst writeMessage \"There is no sin except stupidity\"\nmyWriterProfanityLast writeMessage \"There is no sin except stupidity\"\n\nprintln(myWriterProfanityFirst)\nprintln(myWriterProfanityLast)","title":"代码清单7-17"},{"location":"chapter-08/index.html","text":"","title":"第8章——集合 ·"},{"location":"chapter-08/index.html#第8章-集合","text":"","title":"第8章——集合"},{"location":"chapter-08/index.html#代码清单8-1","text":"val colors1 = Set(\"Blue\", \"Green\", \"Red\")\nprintln(s\"colors1: $colors1\")\n\nval colors2 = colors1 + \"Black\"\nprintln(s\"colors2: $colors2\")\nprintln(s\"colors1: $colors1\")\n运行结果\ncolors1: Set(Blue, Green, Red)\ncolors2: Set(Blue, Green, Red, Black)\ncolors1: Set(Blue, Green, Red)","title":"代码清单8-1"},{"location":"chapter-08/index.html#在repl中执行","text":"scala>  val colors = Set(\"Blue\", \"Green\", \"Red\")\ncolors: scala.collection.immutable.Set[String] = Set(Blue, Green, Red)\n\nscala> colors.getClass\nres0: Class[_ <: scala.collection.immutable.Set[String]] = class \nscala.collection.immutable.Set$Set3\n\nscala> :quit","title":"在REPL中执行"},{"location":"chapter-08/index.html#代码清单8-2","text":"val feeds1 = Set(\"blog.toolshed.com\", \"pragdave.me\", \"blog.agiledeveloper.com\")\nval feeds2 = Set(\"blog.toolshed.com\", \"martinfowler.com/bliki\")","title":"代码清单8-2"},{"location":"chapter-08/index.html#代码清单8-3","text":"val blogFeeds = feeds1 filter (_ contains \"blog\")\nprintln(s\"blog feeds: ${blogFeeds.mkString(\", \")}\")\n运行结果\nblog feeds: blog.toolshed.com, blog.agiledeveloper.com","title":"代码清单8-3"},{"location":"chapter-08/index.html#代码清单8-4","text":"val mergedFeeds = feeds1 ++ feeds2\nprintln(s\"# of merged feeds: ${mergedFeeds.size}\")\n运行结果\n# of merged feeds: 4","title":"代码清单8-4"},{"location":"chapter-08/index.html#代码清单8-5","text":"val commonFeeds = feeds1 & feeds2\nprintln(s\"common feeds: ${commonFeeds.mkString(\", \")}\")\n运行结果\ncommon feeds: blog.toolshed.com","title":"代码清单8-5"},{"location":"chapter-08/index.html#代码清单8-6","text":"val urls = feeds1 map (\"http://\" + _)\nprintln(s\"One url: ${urls.head}\")\n运行结果\nOne url: http://blog.toolshed.com","title":"代码清单8-6"},{"location":"chapter-08/index.html#代码清单8-7","text":"println(\"Refresh Feeds:\")\nfeeds1 foreach { feed ⇒ println(s\"  Refreshing $feed...\") }\n运行结果\nRefresh Feeds:\n  Refreshing blog.toolshed.com...\n  Refreshing pragdave.me...\n  Refreshing blog.agiledeveloper.com...","title":"代码清单8-7"},{"location":"chapter-08/index.html#代码清单8-8","text":"val feeds = Map(\n  \"Andy Hunt\" -> \"blog.toolshed.com\",\n  \"Dave Thomas\" -> \"pragdave.me\",\n  \"NFJS\" -> \"nofluffjuststuff.com/blog\")","title":"代码清单8-8"},{"location":"chapter-08/index.html#代码清单8-9","text":"val filterNameStartWithD = feeds filterKeys (_ startsWith \"D\")\nprintln(s\"# of Filtered: ${filterNameStartWithD.size}\")\n运行结果\n# of Filtered: 1","title":"代码清单8-9"},{"location":"chapter-08/index.html#代码清单8-10","text":"val filterNameStartWithDAndPragprogInFeed = feeds filter { element ⇒\n  val (key, value) = element\n  (key startsWith \"D\") && (value contains \"pragprog\")\n}\nprint(\"# of feeds with auth name D* and pragprog in URL: \")\nprintln(filterNameStartWithDAndPragprogInFeed.size)\n运行结果\n# of feeds with auth name D* and pragprog in URL: 1","title":"代码清单8-10"},{"location":"chapter-08/index.html#代码清单8-11","text":"println(s\"Get Andy's Feed: ${feeds.get(\"Andy Hunt\")}\")\nprintln(s\"Get Bill's Feed: ${feeds.get(\"Bill Who\")}\")\n运行结果\nGet Andy's Feed: Some(blog.toolshed.com)\nGet Bill's Feed: None","title":"代码清单8-11"},{"location":"chapter-08/index.html#代码清单8-12","text":"try {\n  println(s\"Get Andy's Feed Using apply(): ${feeds(\"Andy Hunt\")}\")\n  print(\"Get Bill's Feed: \")\n  println(feeds(\"Bill Who\"))\n} catch {\n  case _: java.util.NoSuchElementException ⇒ println(\"Not found\")\n}\n运行结果\nGet Andy's Feed Using apply(): blog.toolshed.com\nGet Bill's Feed: Not found","title":"代码清单8-12"},{"location":"chapter-08/index.html#代码清单8-13","text":"val newFeeds1 = feeds.updated(\"Venkat Subramaniam\", \"blog.agiledeveloper.com\")\nprintln(\"Venkat's blog in original feeds: \" + feeds.get(\"Venkat Subramaniam\"))\nprintln(\"Venkat's blog in new feed: \" + newFeeds1(\"Venkat Subramaniam\"))\n运行结果\nVenkat's blog in original feeds: None\nVenkat's blog in new feed: blog.agiledeveloper.com","title":"代码清单8-13"},{"location":"chapter-08/index.html#代码清单8-14","text":"val mutableFeeds = scala.collection.mutable.Map(\n  \"Scala Book Forum\" -> \"forums.pragprog.com/forums/87\")\nmutableFeeds(\"Groovy Book Forum\") = \"forums.pragprog.com/forums/246\"\nprintln(s\"Number of forums: ${mutableFeeds.size}\")\n运行结果\nNumber of forums: 2","title":"代码清单8-14"},{"location":"chapter-08/index.html#代码清单8-15","text":"val feeds = List(\"blog.toolshed.com\", \"pragdave.me\", \"blog.agiledeveloper.com\")","title":"代码清单8-15"},{"location":"chapter-08/index.html#代码清单8-16","text":"println(s\"First feed: ${feeds.head}\")\nprintln(s\"Second feed: ${feeds(1)}\")\n运行结果\nFirst feed: blog.toolshed.com\nSecond feed: pragdave.me","title":"代码清单8-16"},{"location":"chapter-08/index.html#代码清单8-17","text":"val prefixedList = \"forums.pragprog.com/forums/87\" :: feeds\nprintln(s\"First Feed In Prefixed: ${prefixedList.head}\")\n运行结果\nFirst Feed In Prefixed: forums.pragprog.com/forums/87","title":"代码清单8-17"},{"location":"chapter-08/index.html#代码清单8-18","text":"val feedsWithForums =\n  feeds ::: List(\n    \"forums.pragprog.com/forums/87\",\n    \"forums.pragprog.com/forums/246\")\nprintln(s\"First feed in feeds with forum: ${feedsWithForums.head}\")\nprintln(s\"Last feed in feeds with forum: ${feedsWithForums.last}\")\n运行结果\nFirst feed in feeds with forum: blog.toolshed.com\nLast feed in feeds with forum: forums.pragprog.com/forums/246","title":"代码清单8-18"},{"location":"chapter-08/index.html#代码清单8-19","text":"val appendedList = feeds ::: List(\"agilelearner.com\")\nprintln(s\"Last Feed In Appended: ${appendedList.last}\")\n运行结果\nLast Feed In Appended: agilelearner.com","title":"代码清单8-19"},{"location":"chapter-08/index.html#代码清单8-20","text":"println(s\"Feeds with blog: ${feeds.filter(_ contains \"blog\").mkString(\", \")}\")\nprintln(s\"All feeds have com: ${feeds.forall(_ contains \"com\")}\")\nprintln(s\"All feeds have dave: ${feeds.forall(_ contains \"dave\")}\")\nprintln(s\"Any feed has dave: ${feeds.exists(_ contains \"dave\")}\")\nprintln(s\"Any feed has bill: ${feeds.exists(_ contains \"bill\")}\")\n运行结果\nFeeds with blog: blog.toolshed.com, blog.agiledeveloper.com\nAll feeds have com: true\nAll feeds have dave: false\nAny feed has dave: true\nAny feed has bill: false","title":"代码清单8-20"},{"location":"chapter-08/index.html#代码清单8-21","text":"println(s\"Feed url lengths: ${feeds.map(_.length).mkString(\", \")}\")\n运行结果\nFeed url lengths: 17, 21, 23","title":"代码清单8-21"},{"location":"chapter-08/index.html#代码清单8-22","text":"val total = feeds.foldLeft(0) { (total, feed) ⇒ total + feed.length }\nprintln(s\"Total length of feed urls: $total\")\n运行结果\nTotal length of feed urls: 61","title":"代码清单8-22"},{"location":"chapter-08/index.html#代码清单8-23","text":"val total2 = (0 /: feeds) { (total, feed) ⇒ total + feed.length }\nprintln(s\"Total length of feed urls: $total2\")\n运行结果\nTotal length of feed urls: 61","title":"代码清单8-23"},{"location":"chapter-08/index.html#代码清单8-24","text":"val total3 = (0 /: feeds) { _ + _.length }\nprintln(s\"Total length of feed urls: $total3\")\n运行结果\nTotal length of feed urls: 61","title":"代码清单8-24"},{"location":"chapter-08/index.html#代码清单8-25","text":"class Cow {\n  def ^(moon: Moon): Unit = println(\"Cow jumped over the moon\")\n}\nclass Moon {\n  def ^:(cow: Cow): Unit = println(\"This cow jumped over the moon too\")\n}","title":"代码清单8-25"},{"location":"chapter-08/index.html#代码清单8-26","text":"val cow = new Cow\nval moon = new Moon\n\ncow ^ moon\ncow ^: moon\n运行结果\nCow jumped over the moon\nThis cow jumped over the moon too","title":"代码清单8-26"},{"location":"chapter-08/index.html#代码清单8-27","text":"class Sample {\n  def unary_+(): Unit = println(\"Called unary +\")\n  def unary_-(): Unit = println(\"called unary -\")\n  def unary_!(): Unit = println(\"called unary !\")\n  def unary_~(): Unit = println(\"called unary ~\")\n}\n\nval sample = new Sample\n+sample\n-sample\n!sample\n~sample\n运行结果\nCalled unary +\ncalled unary -\ncalled unary !\ncalled unary ~","title":"代码清单8-27"},{"location":"chapter-08/index.html#代码清单8-28","text":"for (_ ← 1 to 3) { print(\"ho \") }","title":"代码清单8-28"},{"location":"chapter-08/index.html#代码清单8-29","text":"val result = for (i ← 1 to 10)\n  yield i * 2","title":"代码清单8-29"},{"location":"chapter-08/index.html#代码清单8-30","text":"val result2 = (1 to 10).map(_ * 2)","title":"代码清单8-30"},{"location":"chapter-08/index.html#代码清单8-31","text":"val doubleEven = for (i ← 1 to 10; if i % 2 == 0)\n  yield i * 2","title":"代码清单8-31"},{"location":"chapter-08/index.html#代码清单8-32","text":"for {\n  i ← 1 to 10\n  if i % 2 == 0\n} yield i * 2","title":"代码清单8-32"},{"location":"chapter-08/index.html#代码清单8-33","text":"class Person(val firstName: String, val lastName: String)\nobject Person {\n  def apply(firstName: String, lastName: String): Person =\n    new Person(firstName, lastName)\n}\nval friends = List(Person(\"Brian\", \"Sletten\"), Person(\"Neal\", \"Ford\"),\n  Person(\"Scott\", \"Davis\"), Person(\"Stuart\", \"Halloway\"))\n\nval lastNames =\n  for (friend ← friends; lastName = friend.lastName) yield lastName\n\nprintln(lastNames.mkString(\", \"))\n运行结果\nSletten, Ford, Davis, Halloway","title":"代码清单8-33"},{"location":"chapter-08/index.html#代码清单8-34","text":"for (i ← 1 to 3; j ← 4 to 6) {\n  print(s\"[$i,$j] \")\n}\n运行结果\n[1,4] [1,5] [1,6] [2,4] [2,5] [2,6] [3,4] [3,5] [3,6]","title":"代码清单8-34"},{"location":"chapter-09/index.html","text":"","title":"第9章——模式匹配和正则表达式 ·"},{"location":"chapter-09/index.html#第9章-模式匹配和正则表达式","text":"","title":"第9章——模式匹配和正则表达式"},{"location":"chapter-09/index.html#代码清单9-1","text":"def activity(day: String): Unit = {\n  day match {\n    case \"Sunday\"   ⇒ print(\"Eat, sleep, repeat... \")\n    case \"Saturday\" ⇒ print(\"Hang out with friends... \")\n    case \"Monday\"   ⇒ print(\"...code for fun...\")\n    case \"Friday\"   ⇒ print(\"...read a good book...\")\n  }\n}\nList(\"Monday\", \"Sunday\", \"Saturday\").foreach { activity }\n运行结果\n...code for fun...Eat, sleep, repeat... Hang out with friends...","title":"代码清单9-1"},{"location":"chapter-09/index.html#代码清单9-2","text":"object DayOfWeek extends Enumeration {\n  val SUNDAY = Value(\"Sunday\")\n  val MONDAY = Value(\"Monday\")\n  val TUESDAY = Value(\"Tuesday\")\n  val WEDNESDAY = Value(\"Wednesday\")\n  val THURSDAY = Value(\"Thursday\")\n  val FRIDAY = Value(\"Friday\")\n  val SATURDAY = Value(\"Saturday\")\n}\n\ndef activity(day: DayOfWeek.Value): Unit = {\n  day match {\n    case DayOfWeek.SUNDAY   ⇒ println(\"Eat, sleep, repeat...\")\n    case DayOfWeek.SATURDAY ⇒ println(\"Hang out with friends\")\n    case _                  ⇒ println(\"...code for fun...\")\n  }\n}\n\nactivity(DayOfWeek.SATURDAY)\nactivity(DayOfWeek.MONDAY)\n运行结果\nHang out with friends\n...code for fun...","title":"代码清单9-2"},{"location":"chapter-09/index.html#代码清单9-3","text":"def processCoordinates(input: Any): Unit = {\n  input match {\n    case (lat, long) ⇒ printf(\"Processing (%d, %d)...\", lat, long)\n    case \"done\"      ⇒ println(\"done\")\n    case _           ⇒ println(\"invalid input\")\n  }\n}\n\nprocessCoordinates((39, -104))\nprocessCoordinates(\"done\")\n运行结果\nProcessing (39, -104)...done","title":"代码清单9-3"},{"location":"chapter-09/index.html#代码清单9-4","text":"def processItems(items: List[String]): Unit = {\n  items match {\n    case List(\"apple\", \"ibm\")         ⇒ println(\"Apples and IBMs\")\n    case List(\"red\", \"blue\", \"white\") ⇒ println(\"Stars and Stripes...\")\n    case List(\"red\", \"blue\", _*)      ⇒ println(\"colors red, blue,... \")\n    case List(\"apple\", \"orange\", otherFruits @ _*) ⇒\n      println(\"apples, oranges, and \" + otherFruits)\n  }\n}\n\nprocessItems(List(\"apple\", \"ibm\"))\nprocessItems(List(\"red\", \"blue\", \"green\"))\nprocessItems(List(\"red\", \"blue\", \"white\"))\nprocessItems(List(\"apple\", \"orange\", \"grapes\", \"dates\"))\n运行结果\nApples and IBMs\ncolors red, blue,... \nStars and Stripes...\napples, oranges, and List(grapes, dates)","title":"代码清单9-4"},{"location":"chapter-09/index.html#代码清单9-5","text":"def process(input: Any): Unit = {\n  input match {\n    case (_: Int, _: Int)          ⇒ print(\"Processing (int, int)... \")\n    case (_: Double, _: Double)    ⇒ print(\"Processing (double, double)... \")\n    case msg: Int if msg > 1000000 ⇒ println(\"Processing int > 1000000\")\n    case _: Int                    ⇒ print(\"Processing int... \")\n    case _: String                 ⇒ println(\"Processing string... \")\n    case _                         ⇒ printf(s\"Can't handle $input... \")\n  }\n}\n\nprocess((34.2, -159.3))\nprocess(0)\nprocess(1000001)\nprocess(2.2)\n运行结果\nProcessing (double, double)... Processing int... Processing int > 1000000\nCan't handle 2.2...","title":"代码清单9-5"},{"location":"chapter-09/index.html#代码清单9-6","text":"class Sample {\n  val max = 100\n\n  def process(input: Int): Unit = {\n    input match {\n      case max ⇒ println(s\"You matched max $max\")\n    }\n  }\n}\n\nval sample = new Sample\ntry {\n  sample.process(0)\n} catch {\n  case ex: Throwable ⇒ println(ex)\n}\nsample.process(100)\n运行结果\nYou matched max 0\nYou matched max 100","title":"代码清单9-6"},{"location":"chapter-09/index.html#代码清单9-7","text":"class Sample {\n  val MAX = 100\n\n  def process(input: Int): Unit = {\n    input match {\n      case MAX ⇒ println(\"You matched max\")\n    }\n  }\n}\n\nval sample = new Sample\ntry {\n  sample.process(0)\n} catch {\n  case ex: Throwable ⇒ println(ex)\n}\nsample.process(100)\n运行结果\nscala.MatchError: 0 (of class java.lang.Integer)\nYou matched max","title":"代码清单9-7"},{"location":"chapter-09/index.html#代码清单9-8","text":"trait Trade\ncase class Sell(stockSymbol: String, quantity: Int) extends Trade\ncase class Buy(stockSymbol: String, quantity: Int) extends Trade\ncase class Hedge(stockSymbol: String, quantity: Int) extends Trade","title":"代码清单9-8"},{"location":"chapter-09/index.html#代码清单9-9","text":"object TradeProcessor {\n  def processTransaction(request: Trade): Unit = {\n    request match {\n      case Sell(stock, 1000) ⇒ println(s\"Selling 1000-units of $stock\")\n      case Sell(stock, quantity) ⇒\n        println(s\"Selling $quantity units of $stock\")\n      case Buy(stock, quantity) if quantity > 2000 ⇒\n        println(s\"Buying $quantity (large) units of $stock\")\n      case Buy(stock, quantity) ⇒\n        println(s\"Buying $quantity units of $stock\")\n    }\n  }\n}","title":"代码清单9-9"},{"location":"chapter-09/index.html#代码清单9-10","text":"TradeProcessor.processTransaction(Sell(\"GOOG\", 500))\nTradeProcessor.processTransaction(Buy(\"GOOG\", 700))\nTradeProcessor.processTransaction(Sell(\"GOOG\", 1000))\nTradeProcessor.processTransaction(Buy(\"GOOG\", 3000))\n运行结果\nSelling 500 units of GOOG\nBuying 700 units of GOOG\nSelling 1000-units of GOOG\nBuying 3000 (large) units of GOOG","title":"代码清单9-10"},{"location":"chapter-09/index.html#代码清单9-11","text":"case class Apple()\ncase class Orange()\ncase class Book()\n\nobject ThingsAcceptor {\n  def acceptStuff(thing: Any): Unit = {\n    thing match {\n      case Apple()  ⇒ println(\"Thanks for the Apple\")\n      case Orange() ⇒ println(\"Thanks for the Orange\")\n      case Book()   ⇒ println(\"Thanks for the Book\")\n      case _        ⇒ println(s\"Excuse me, why did you send me $thing\")\n    }\n  }\n}","title":"代码清单9-11"},{"location":"chapter-09/index.html#代码清单9-12","text":"ThingsAcceptor.acceptStuff(Apple())\nThingsAcceptor.acceptStuff(Book())\nThingsAcceptor.acceptStuff(Apple)\n运行结果\nThanks for the Apple\nThanks for the Book\nExcuse me, why did you send me Apple","title":"代码清单9-12"},{"location":"chapter-09/index.html#代码清单9-13","text":"abstract class Thing\ncase class Apple() extends Thing\n\nobject ThingsAcceptor {\n  def acceptStuff(thing: Thing) {\n    thing match {\n      //...\n      case _ ⇒\n    }\n  }\n}\n\nThingsAcceptor.acceptStuff(Apple) //error: type mismatch;","title":"代码清单9-13"},{"location":"chapter-09/index.html#代码清单9-14","text":"StockService process \"GOOG\"\nStockService process \"IBM\"\nStockService process \"ERR\"","title":"代码清单9-14"},{"location":"chapter-09/index.html#代码清单9-15","text":"object StockService {\n  def process(input: String): Unit = {\n    input match {\n      case Symbol() ⇒ println(s\"Look up price for valid symbol $input\")\n      case _        ⇒ println(s\"Invalid input $input\")\n    }\n  }\n}","title":"代码清单9-15"},{"location":"chapter-09/index.html#代码清单9-16","text":"object Symbol {\n  def unapply(symbol: String): Boolean = {\n    // you'd look up a database... here only GOOG and IBM are recognized\n    symbol == \"GOOG\" || symbol == \"IBM\"\n  }\n}\n运行结果\nLook up price for valid symbol GOOG\nLook up price for valid symbol IBM\nInvalid input ERR","title":"代码清单9-16"},{"location":"chapter-09/index.html#代码清单9-17","text":"object StockService {\n  def process(input: String): Unit = {\n    input match {\n      case Symbol() ⇒ println(s\"Look up price for valid symbol $input\")\n      case ReceiveStockPrice(symbol, price) ⇒\n        println(s\"Received price $$$price for symbol $symbol\")\n      case _ ⇒ println(s\"Invalid input $input\")\n    }\n  }\n}","title":"代码清单9-17"},{"location":"chapter-09/index.html#代码清单9-18","text":"object ReceiveStockPrice {\n  def unapply(input: String): Option[(String, Double)] = {\n    try {\n      if (input contains \":\") {\n        val splitQuote = input split \":\"\n        Some((splitQuote(0), splitQuote(1).toDouble))\n      } else {\n        None\n      }\n    } catch {\n      case _: NumberFormatException ⇒ None\n    }\n  }\n}","title":"代码清单9-18"},{"location":"chapter-09/index.html#代码清单9-19","text":"StockService process \"GOOG\"\nStockService process \"GOOG:310.84\"\nStockService process \"GOOG:BUY\"\nStockService process \"ERR:12.21\"\n运行结果\nLook up price for valid symbol GOOG\nReceived price $310.84 for symbol GOOG\nInvalid input GOOG:BUY\nReceived price $12.21 for symbol ERR","title":"代码清单9-19"},{"location":"chapter-09/index.html#代码清单9-20","text":"case ReceiveStockPrice(symbol @ Symbol(), price) ⇒\n  println(s\"Received price $$$price for symbol $symbol\")\n运行结果\nLook up price for valid symbol GOOG\nReceived price $310.84 for symbol GOOG\nInvalid input GOOG:BUY\nInvalid input ERR:12.21","title":"代码清单9-20"},{"location":"chapter-09/index.html#代码清单9-21","text":"val pattern = \"(S|s)cala\".r\nval str = \"Scala is scalable and cool\"\nprintln(pattern findFirstIn str)","title":"代码清单9-21"},{"location":"chapter-09/index.html#代码清单9-22","text":"println((pattern findAllIn str).mkString(\", \"))","title":"代码清单9-22"},{"location":"chapter-09/index.html#代码清单9-23","text":"println(\"cool\".r replaceFirstIn (str, \"awesome\"))\n运行结果\nSome(Scala)\nScala, scala\nScala is scalable and awesome","title":"代码清单9-23"},{"location":"chapter-09/index.html#代码清单9-24","text":"def process(input: String): Unit = {\n  val GoogStock = \"\"\"^GOOG:(\\d*\\.\\d+)\"\"\".r\n  input match {\n    case GoogStock(price) ⇒ println(s\"Price of GOOG is $$$price\")\n    case _                ⇒ println(s\"not processing $input\")\n  }\n}\nprocess(\"GOOG:310.84\")\nprocess(\"GOOG:310\")\nprocess(\"IBM:84.01\")\n运行结果\nPrice of GOOG is $310.84\nnot processing GOOG:310\nnot processing IBM:84.01","title":"代码清单9-24"},{"location":"chapter-09/index.html#代码清单9-25","text":"def process(input: String): Unit = {\n  val MatchStock = \"\"\"^(.+):(\\d*\\.\\d+)\"\"\".r\n  input match {\n    case MatchStock(\"GOOG\", price) ⇒ println(s\"We got GOOG at $$$price\")\n    case MatchStock(\"IBM\", price)  ⇒ println(s\"IBM's trading at $$$price\")\n    case MatchStock(symbol, price) ⇒ println(s\"Price of $symbol is $$$price\")\n    case _                         ⇒ println(s\"not processing $input\")\n  }\n}\nprocess(\"GOOG:310.84\")\nprocess(\"IBM:84.01\")\nprocess(\"GE:15.96\")\n运行结果\nWe got GOOG at $310.84\nIBM's trading at $84.01\nPrice of GE is $15.96","title":"代码清单9-25"},{"location":"chapter-10/index.html","text":"","title":"第10章——处理异常 ·"},{"location":"chapter-10/index.html#第10章-处理异常","text":"","title":"第10章——处理异常"},{"location":"chapter-10/index.html#代码清单10-1","text":"throw new IllegalArgumentException","title":"代码清单10-1"},{"location":"chapter-10/index.html#代码清单10-2","text":"// Java code\ntry {\n  Thread.sleep(1000);\n}                    \ncatch(InterruptedException ex) {\n  // Losing sleep over what to do here?\n}","title":"代码清单10-2"},{"location":"chapter-10/index.html#代码清单10-3","text":"object Tax {\n  def taxFor(amount: Double): Double = {\n    if (amount < 0)\n      throw new IllegalArgumentException(\"Amount must be greater than zero\")\n\n    if (amount < 0.01)\n      throw new RuntimeException(\"Amount too small to be taxed\")\n\n    if (amount > 1000000) throw new Exception(\"Amount too large...\")\n\n    amount * 0.08\n  }\n}","title":"代码清单10-3"},{"location":"chapter-10/index.html#代码清单10-4","text":"for (amount ← List(100.0, 0.009, -2.0, 1000001.0)) {\n  try {\n    print(s\"Amount: $$$amount \")\n    println(s\"Tax: $$${Tax.taxFor(amount)}\")\n  } catch {\n    case ex: IllegalArgumentException ⇒ println(ex.getMessage)\n    case ex: RuntimeException ⇒\n      // if you need a block of code to handle exception\n      println(s\"Don't bother reporting...${ex.getMessage}\")\n  }\n}\n运行结果\nAmount: $100.0 Tax: $8.0\nAmount: $0.009 Don't bother reporting...Amount too small to be taxed\nAmount: $-2.0 Amount must be greater than zero\nAmount: $1000001.0 java.lang.Exception: Amount too large...\n\tat Tax$.taxFor(Tax.scala:9)\n...","title":"代码清单10-4"},{"location":"chapter-10/index.html#代码清单10-5","text":"for (amount ← List(100.0, 0.009, -2.0, 1000001.0)) {\n  try {\n    print(s\"Amount: $$$amount \")\n    println(s\"Tax: $$${Tax.taxFor(amount)}\")\n  } catch {\n    case ex: IllegalArgumentException ⇒ println(ex.getMessage)\n    case _: Throwable                 ⇒ println(\"Something went wrong\")\n  }\n}\n运行结果\nAmount: $100.0 Tax: $8.0\nAmount: $0.009 Something went wrong\nAmount: $-2.0 Amount must be greater than zero\nAmount: $1000001.0 Something went wrong","title":"代码清单10-5"},{"location":"chapter-10/index.html#代码清单10-6","text":"//Java code—will not compile due to incorrect catch order\npublic class JavaCatchOrder {\n  public void catchOrderExample() {\n    try {\n      String str = \"hello\";\n      System.out.println(str.charAt(31));\n    }\n    catch(Exception ex) { System.out.println(\"Exception caught\"); }\n    catch(StringIndexOutOfBoundsException ex) { //ERROR\n      System.out.println(\"Invalid Index\"); }\n  }\n}\n运行结果\nJavaCatchOrder.java:10: error: exception StringIndexOutOfBoundsException\nhas already been caught\n    catch(StringIndexOutOfBoundsException ex) { //ERROR\n    ^\n1 error","title":"代码清单10-6"},{"location":"chapter-10/index.html#代码清单10-6","text":"val amount = -2\ntry {\n  print(s\"Amount: $$$amount \")\n  println(s\"Tax: $$${Tax.taxFor(amount)}\")\n} catch {\n  case _: Exception                 ⇒ println(\"Something went wrong\")\n  case ex: IllegalArgumentException ⇒ println(ex.getMessage)\n}\n运行结果\nAmount: $-2 Something went wrong","title":"代码清单10-6"},{"location":"chapter-11/index.html","text":"","title":"第11章——递归编程 ·"},{"location":"chapter-11/index.html#第11章-递归编程","text":"","title":"第11章——递归编程"},{"location":"chapter-11/index.html#代码清单11-1-programmingrecursions-factorial-scala-","text":"def factorial(number: Int): BigInt = {\n  if (number == 0)\n    1\n  else\n    number * factorial(number - 1)\n}","title":"代码清单11-1（ProgrammingRecursions/factorial.scala）"},{"location":"chapter-12/index.html","text":"","title":"第12章——惰性求值和并行集合 ·"},{"location":"chapter-12/index.html#第12章-惰性求值和并行集合","text":"","title":"第12章——惰性求值和并行集合"},{"location":"chapter-12/index.html#代码清单12-1","text":"def expensiveComputation() = {\n  println(\"...assume slow operation...\")\n  false\n}\n\ndef evaluate(input: Int): Unit = {\n  println(s\"evaluate called with $input\")\n  if (input >= 10 && expensiveComputation())\n    println(\"doing work...\")\n  else\n    println(\"skipping\")\n}\n\nevaluate(0)\nevaluate(100)\n运行结果\nevaluate called with 0\nskipping\nevaluate called with 100\n...assume slow operation...\nskipping","title":"代码清单12-1"},{"location":"chapter-12/index.html#代码清单12-2","text":"val perform = expensiveComputation()\nif (input >= 10 && perform)\n运行结果\nevaluate called with 0\n...assume slow operation...\nskipping\nevaluate called with 100\n...assume slow operation...\nskipping","title":"代码清单12-2"},{"location":"chapter-12/index.html#代码清单12-3","text":"@volatile lazy val perform = expensiveComputation()\nif (input >= 10 && perform)\n  println(\"doing work...\")\n运行结果\nevaluate called with 0\nskipping\nevaluate called with 100\n...assume slow operation...\nskipping","title":"代码清单12-3"},{"location":"chapter-12/index.html#代码清单12-4","text":"import scala.io._\n\ndef read = StdIn.readInt()\n\n@volatile lazy val first = read\n@volatile lazy val second = read\n\nif (Math.random() < 0.5)\n  second\n\nprintln(first - second)\n运行结果\n> scala lazyOrder.scala\n1\n2\n1\n> scala lazyOrder.scala \n1\n2\n-1\n>","title":"代码清单12-4"},{"location":"chapter-12/index.html#代码清单12-5","text":"val people = List((\"Mark\", 32), (\"Bob\", 22), (\"Jane\", 8), (\"Jill\", 21),\n  (\"Nick\", 50), (\"Nancy\", 42), (\"Mike\", 19), (\"Sara\", 12), (\"Paula\", 42),\n  (\"John\", 21))\n\ndef isOlderThan17(person: (String, Int)) = {\n  println(s\"isOlderThan17 called for $person\")\n  val (_, age) = person\n  age > 17\n}\n\ndef isNameStartsWithJ(person: (String, Int)) = {\n  println(s\"isNameStartsWithJ called for $person\")\n  val (name, _) = person\n  name.startsWith(\"J\")\n}\n\nprintln(people.filter { isOlderThan17 }.filter { isNameStartsWithJ }.head)\n运行结果\nisOlderThan17 called for (Mark,32)\nisOlderThan17 called for (Bob,22)\nisOlderThan17 called for (Jane,8)\nisOlderThan17 called for (Jill,21)\nisOlderThan17 called for (Nick,50)\nisOlderThan17 called for (Nancy,42)\nisOlderThan17 called for (Mike,19)\nisOlderThan17 called for (Sara,12)\nisOlderThan17 called for (Paula,42)\nisOlderThan17 called for (John,21)\nisNameStartsWithJ called for (Mark,32)\nisNameStartsWithJ called for (Bob,22)\nisNameStartsWithJ called for (Jill,21)\nisNameStartsWithJ called for (Nick,50)\nisNameStartsWithJ called for (Nancy,42)\nisNameStartsWithJ called for (Mike,19)\nisNameStartsWithJ called for (Paula,42)\nisNameStartsWithJ called for (John,21)\n(Jill,21)","title":"代码清单12-5"},{"location":"chapter-12/index.html#代码清单12-6","text":"println(people.view.filter { isOlderThan17 }.filter { isNameStartsWithJ }.head)\n运行结果\nisOlderThan17 called for (Mark,32)\nisNameStartsWithJ called for (Mark,32)\nisOlderThan17 called for (Bob,22)\nisNameStartsWithJ called for (Bob,22)\nisOlderThan17 called for (Jane,8)\nisOlderThan17 called for (Jill,21)\nisNameStartsWithJ called for (Jill,21)\n(Jill,21)","title":"代码清单12-6"},{"location":"chapter-12/index.html#代码清单12-7","text":"def generate(starting: Int): Stream[Int] = {\n  starting #:: generate(starting + 1)\n}\n\nprintln(generate(25))\n运行结果\nStream(25, ?)","title":"代码清单12-7"},{"location":"chapter-12/index.html#代码清单12-8","text":"println(generate(25).take(10).force)\nprintln(generate(25).take(10).toList)\n运行结果\nStream(25, 26, 27, 28, 29, 30, 31, 32, 33, 34)\nList(25, 26, 27, 28, 29, 30, 31, 32, 33, 34)","title":"代码清单12-8"},{"location":"chapter-12/index.html#代码清单12-9","text":"println(generate(25).takeWhile { _ < 40 }.force)\n运行结果\nStream(25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39)","title":"代码清单12-9"},{"location":"chapter-12/index.html#代码清单12-10","text":"def isDivisibleBy(number: Int, divisor: Int) = number % divisor == 0\n\ndef isPrime(number: Int) =\n  number > 1 && !(2 until number).exists { isDivisibleBy(number, _) }\n\ndef primes(starting: Int): Stream[Int] = {\n  println(s\"computing for $starting\")\n  if (isPrime(starting))\n    starting #:: primes(starting + 1)\n  else\n    primes(starting + 1)\n}","title":"代码清单12-10"},{"location":"chapter-12/index.html#代码清单12-11","text":"val primesFrom100 = primes(100)\n\nprintln(primesFrom100.take(3).toList)\nprintln(\"Let's ask for more...\")\nprintln(primesFrom100.take(4).toList)\n运行结果\ncomputing for 100\ncomputing for 101\ncomputing for 102\ncomputing for 103\ncomputing for 104\ncomputing for 105\ncomputing for 106\ncomputing for 107\nList(101, 103, 107)\nLet's ask for more...\ncomputing for 108\ncomputing for 109\nList(101, 103, 107, 109)","title":"代码清单12-11"},{"location":"chapter-12/index.html#代码清单12-12","text":"import scala.io.Source\nimport scala.xml._\n\ndef getWeatherData(city: String) = {\n  val url = \"http://api.openweathermap.org/data/2.5/weather\"\n\n  val response = Source.fromURL(s\"$url?q=$city&units=imperial&mode=xml\")\n  val xmlResponse = XML.loadString(response.mkString)\n  val cityName = (xmlResponse \\\\ \"city\" \\ \"@name\").text\n  val temperature = (xmlResponse \\\\ \"temperature\" \\ \"@value\").text\n  val condition = (xmlResponse \\\\ \"weather\" \\ \"@value\").text\n  (cityName, temperature, condition)\n}","title":"代码清单12-12"},{"location":"chapter-12/index.html#代码清单12-13","text":"def printWeatherData(weatherData: (String, String, String)): Unit = {\n  val (cityName, temperature, condition) = weatherData\n\n  println(f\"$cityName%-15s $temperature%-6s $condition\")\n}","title":"代码清单12-13"},{"location":"chapter-12/index.html#代码清单12-14","text":"def timeSample(getData: List[String] ⇒ List[(String, String, String)]): Unit = {\n  val cities = List(\"Houston,us\", \"Chicago,us\", \"Boston,us\", \"Minneapolis,us\",\n    \"Oslo,norway\", \"Tromso,norway\", \"Sydney,australia\", \"Berlin,germany\",\n    \"London,uk\", \"Krakow,poland\", \"Rome,italy\", \"Stockholm,sweden\",\n    \"Bangalore,india\", \"Brussels,belgium\", \"Reykjavik,iceland\")\n\n  val start = System.nanoTime\n  getData(cities) sortBy { _._1 } foreach printWeatherData\n  val end = System.nanoTime\n  println(s\"Time taken: ${(end - start) / 1.0e9} sec\")\n}\n运行结果\nBengaluru       84.2   few clouds\nBerlin          45.63  broken clouds\nBoston          52.23  scattered clouds\nBrussels        50.83  Sky is Clear\nChicago         46.13  sky is clear\nCracow          40.39  moderate rain\nHouston         54.01  light intensity drizzle\nLondon          55.33  Sky is Clear\nMinneapolis     42.82  sky is clear\nOslo            47.3   Sky is Clear\nReykjavik       31.17  proximity shower rain\nRome            58.42  few clouds\nStockholm       47.28  Sky is Clear\nSydney          68.9   Sky is Clear\nTromso          35.6   proximity shower rain\nTime taken: 67.208944087 sec","title":"代码清单12-14"},{"location":"chapter-12/index.html#代码清单12-15","text":"timeSample { cities ⇒ cities map getWeatherData }\n运行结果\nBengaluru       84.2   few clouds\nBerlin          45.63  broken clouds\nBoston          52.23  scattered clouds\nBrussels        50.83  Sky is Clear\nChicago         46.13  sky is clear\nCracow          40.39  moderate rain\nHouston         54.01  light intensity drizzle\nLondon          55.33  Sky is Clear\nMinneapolis     42.82  sky is clear\nOslo            47.3   Sky is Clear\nReykjavik       31.17  proximity shower rain\nRome            58.42  few clouds\nStockholm       47.28  Sky is Clear\nSydney          68.9   Sky is Clear\nTromso          35.6   proximity shower rain\nTime taken: 0.171599394 sec","title":"代码清单12-15"},{"location":"chapter-13/index.html","text":"","title":"第13章——使用Actor模型处理并发 ·"},{"location":"chapter-13/index.html#第13章-使用actor模型处理并发","text":"","title":"第13章——使用Actor模型处理并发"},{"location":"chapter-13/index.html#代码清单13-1","text":"import java.io.File\n\ndef getChildren(file: File) = {\n  val children = file.listFiles()\n  if (children != null) children.toList else List()\n}\n\nval start = System.nanoTime\nval exploreFrom = new File(args(0))\n\nvar count = 0L\nvar filesToVisit = List(exploreFrom)\n\nwhile (filesToVisit.nonEmpty) {\n  val head = filesToVisit.head\n  filesToVisit = filesToVisit.tail\n\n  val children = getChildren(head)\n  count = count + children.count { !_.isDirectory }\n  filesToVisit = filesToVisit ::: children.filter { _.isDirectory }\n}\n\nval end = System.nanoTime\nprintln(s\"Number of files found: $count\")\nprintln(s\"Time taken: ${(end - start) / 1.0e9} seconds\")\n运行结果\nNumber of files found: 479758\nTime taken: 66.524453436 seconds","title":"代码清单13-1"},{"location":"chapter-13/index.html#代码清单13-2","text":"import akka.actor._\n\nclass HollywoodActor() extends Actor {\n  def receive: PartialFunction[Any, Unit] = {\n    case message ⇒ println(s\"playing the role of $message\")\n  }\n}","title":"代码清单13-2"},{"location":"chapter-13/index.html#代码清单13-3","text":"import akka.actor._\n\nimport scala.concurrent.Await\nimport scala.concurrent.duration.Duration\n\nobject CreateActors extends App {\n  val system = ActorSystem(\"sample\")\n\n  val depp = system.actorOf(Props[HollywoodActor])\n\n  depp ! \"Wonka\"\n\n  val terminateFuture = system.terminate()\n  Await.ready(terminateFuture, Duration.Inf)\n}\n运行结果\nplaying the role of Wonka","title":"代码清单13-3"},{"location":"chapter-13/index.html#代码清单13-4","text":"val depp = system.actorOf(Props[HollywoodActor])\nval hanks = system.actorOf(Props[HollywoodActor])\n\ndepp ! \"Wonka\"\nhanks ! \"Gump\"\n\ndepp ! \"Sparrow\"\nhanks ! \"Phillips\"\nprintln(s\"Calling from ${Thread.currentThread}\")\n运行结果\nWonka - Thread[sample-akka.actor.default-dispatcher-2,5,main]\nGump - Thread[sample-akka.actor.default-dispatcher-3,5,main]\nCalling from Thread[main,5,main]\nPhillips - Thread[sample-akka.actor.default-dispatcher-3,5,main]\nSparrow - Thread[sample-akka.actor.default-dispatcher-2,5,main]","title":"代码清单13-4"},{"location":"chapter-13/index.html#代码清单13-5","text":"depp ! \"Wonka\"\nhanks ! \"Gump\"\n\nThread.sleep(100)\n\ndepp ! \"Sparrow\"\nhanks ! \"Phillips\"\n运行结果\nWonka - Thread[sample-akka.actor.default-dispatcher-3,5,main]\nGump - Thread[sample-akka.actor.default-dispatcher-4,5,main]\nSparrow - Thread[sample-akka.actor.default-dispatcher-4,5,main]\nPhillips - Thread[sample-akka.actor.default-dispatcher-3,5,main]\nCalling from Thread[main,5,main]","title":"代码清单13-5"},{"location":"chapter-13/index.html#代码清单13-6","text":"import akka.actor._\nimport scala.collection._\n\ncase class Play(role: String)\ncase class ReportCount(role: String)\n\nclass HollywoodActor() extends Actor {\n  val messagesCount: mutable.Map[String, Int] = mutable.Map()\n\n  def receive: PartialFunction[Any, Unit] = {\n    case Play(role) ⇒\n      val currentCount = messagesCount.getOrElse(role, 0)\n      messagesCount.update(role, currentCount + 1)\n      println(s\"Playing $role\")\n\n    case ReportCount(role) ⇒\n      sender ! messagesCount.getOrElse(role, 0)\n  }\n}","title":"代码清单13-6"},{"location":"chapter-13/index.html#代码清单13-7","text":"import akka.actor._\nimport akka.pattern.ask\nimport akka.util.Timeout\nimport chapter13.HollywoodActor4.{ Play, ReportCount }\n\nimport scala.concurrent.Await\nimport scala.concurrent.duration._\n\nobject UseActor extends App {\n  val system = ActorSystem(\"sample\")\n\n  val depp = system.actorOf(Props[HollywoodActor])\n  val hanks = system.actorOf(Props[HollywoodActor])\n\n  depp ! Play(\"Wonka\")\n  hanks ! Play(\"Gump\")\n\n  depp ! Play(\"Wonka\")\n  depp ! Play(\"Sparrow\")\n\n  println(\"Sent roles to play\")\n\n  implicit val timeout: Timeout = Timeout(2.seconds)\n  val wonkaFuture = depp ? ReportCount(\"Wonka\")\n  val sparrowFuture = depp ? ReportCount(\"Sparrow\")\n  val gumpFuture = hanks ? ReportCount(\"Gump\")\n\n  val wonkaCount = Await.result(wonkaFuture, timeout.duration)\n  val sparrowCount = Await.result(sparrowFuture, timeout.duration)\n  val gumpCount = Await.result(gumpFuture, timeout.duration)\n\n  println(s\"Depp played Wonka $wonkaCount time(s)\")\n  println(s\"Depp played Sparrow $sparrowCount time(s)\")\n  println(s\"Hanks played Gump $gumpCount time(s)\")\n\n  val terminateFuture = system.terminate()\n  Await.ready(terminateFuture, Duration.Inf)\n}\n运行结果\nSent roles to play\nPlaying Wonka\nPlaying Gump\nPlaying Wonka\nPlaying Sparrow\nDepp played Wonka 2 time(s)\nDepp played Sparrow 1 time(s)\nHanks played Gump 1 time(s)","title":"代码清单13-7"},{"location":"chapter-13/index.html#代码清单13-8","text":"import akka.actor._\nimport java.io._\n\nclass FileExplorer extends Actor {\n  def receive: PartialFunction[Any, Unit] = {\n    case dirName: String ⇒\n      val file = new File(dirName)\n      val children = file.listFiles()\n      var filesCount = 0\n\n      if (children != null) {\n        children.filter { _.isDirectory }\n          .foreach { sender ! _.getAbsolutePath }\n        filesCount = children.count { !_.isDirectory }\n      }\n\n      sender ! filesCount\n  }\n}","title":"代码清单13-8"},{"location":"chapter-13/index.html#代码清单13-9","text":"import akka.actor._\nimport akka.routing._\n\nimport scala.concurrent.Await\nimport scala.concurrent.duration.Duration\n\nclass FilesCounter extends Actor {\n  val start: Long = System.nanoTime\n  var filesCount = 0L\n  var pending = 0\n\n  val fileExplorers: ActorRef =\n    context.actorOf(RoundRobinPool(100).props(Props[FileExplorer]))\n\n  def receive: PartialFunction[Any, Unit] = {\n    case dirName: String ⇒\n      pending = pending + 1\n      fileExplorers ! dirName\n\n    case count: Int ⇒\n      filesCount = filesCount + count\n      pending = pending - 1\n\n      if (pending == 0) {\n        val end = System.nanoTime\n        println(s\"Files count: $filesCount\")\n        println(s\"Time taken: ${(end - start) / 1.0e9} seconds\")\n        val terminateFuture = context.system.terminate()\n        Await.ready(terminateFuture, Duration.Inf)\n      }\n  }\n}","title":"代码清单13-9"},{"location":"chapter-13/index.html#代码清单13-10","text":"import akka.actor._\n\nobject CountFiles extends App {\n  val system = ActorSystem(\"sample\")\n\n  val filesCounter = system.actorOf(Props[FilesCounter])\n\n  filesCounter ! args(0)\n}\n运行结果\nFiles count: 479758\nTime taken: 5.609851764 seconds","title":"代码清单13-10"},{"location":"chapter-14/index.html","text":"","title":"第14章——和Java进行互操作 ·"},{"location":"chapter-14/index.html#第14章-和java进行互操作","text":"","title":"第14章——和Java进行互操作"},{"location":"chapter-14/index.html#代码清单14-1","text":"class Person(val firstName: String, val lastName: String) {\n  override def toString: String = firstName + \" \" + lastName\n}","title":"代码清单14-1"},{"location":"chapter-14/index.html#代码清单14-2","text":"class Dog(val name: String) {\n  override def toString: String = name\n}","title":"代码清单14-2"},{"location":"chapter-14/index.html#代码清单14-3","text":"val george = new Person(\"George\", \"Washington\")\n\nval georgesDogs = List(new Dog(\"Captain\"), new Dog(\"Clode\"),\n  new Dog(\"Forester\"), new Dog(\"Searcher\"))\n\nprintln(s\"$george had several dogs ${georgesDogs.mkString(\", \")}...\")\n运行结果\nGeorge Washington had several dogs Captain, Clode, Forester, Searcher...","title":"代码清单14-3"},{"location":"chapter-14/index.html#代码清单14-4","text":"object UsePersonClass extends App {\n  val ben = new Person(\"Ben\", \"Franklin\")\n  println(s\"$ben was a great inventor.\")\n}\n运行结果\nBen Franklin was a great inventor.","title":"代码清单14-4"},{"location":"chapter-14/index.html#代码清单14-5","text":"import java.util.Currency\n\nval currencies = Currency.getAvailableCurrencies\nprintln(s\"${currencies.size} currencies are available.\")\n运行结果\n220 currencies are available.","title":"代码清单14-5"},{"location":"chapter-14/index.html#代码清单14-6","text":"//Java code\npackage chapter14.usingjava;\n\npublic enum InvestmentType {\n  BOND,  STOCK, REAL_ESTATE,  COMMODITIES,  COLLECTIBLES, MUTUAL_FUNDS\n}\n运行结果\nclass investments.Investment","title":"代码清单14-6"},{"location":"chapter-14/index.html#代码清单14-7","text":"//Java code\npackage chapter14.usingjava;\n\npublic class Investment {                                        \n  private String investmentName;\n  private InvestmentType investmentType;\n             \n  public Investment(String name, InvestmentType type) {\n    investmentName = name;\n    investmentType = type;\n  } \n  public int yield() { return 0; }\n}","title":"代码清单14-7"},{"location":"chapter-14/index.html#代码清单14-8","text":"import chapter14.usingjava.{ Investment, InvestmentType }\n\nobject UseInvestment extends App {\n  val investment = new Investment(\"XYZ Corporation\", InvestmentType.STOCK)\n  println(investment.getClass)\n}","title":"代码清单14-8"},{"location":"chapter-14/index.html#代码清单14-9","text":"val theYield1 = investment.yield   //ERROR\nval theYield2 = investment.yield() //ERROR","title":"代码清单14-9"},{"location":"chapter-14/index.html#代码清单14-10","text":"val theYield1 = investment.`yield`\nval theYield2 = investment.`yield`()","title":"代码清单14-10"},{"location":"chapter-14/index.html#代码清单14-11","text":"package chapter14\n\nclass Car(val year: Int) {\n  private[this] var miles: Int = 0\n\n  def drive(distance: Int): Unit = { miles += distance }\n\n  override def toString: String = s\"year: $year miles: $miles\"\n}","title":"代码清单14-11"},{"location":"chapter-14/index.html#代码清单14-12","text":"//Java code\npackage chapter14;\n\npublic class UseCar {\n  public static void main(String[] args) {\n    Car car = new Car(2009);\n    \n    System.out.println(car);\n    car.drive(10);\n    System.out.println(car);\n  }\n}","title":"代码清单14-12"},{"location":"chapter-14/index.html#代码清单14-13","text":"trait Writable {\n  def write(message: String): Unit\n}","title":"代码清单14-13"},{"location":"chapter-14/index.html#代码清单14-14","text":"//Java code\npublic class AWritableJavaClass implements Writable {\n  public void write(String message) {\n    //...code...\n  }\n}","title":"代码清单14-14"},{"location":"chapter-14/index.html#代码清单14-15","text":"trait Printable {\n  def print(): Unit = {\n    println(\"running printable...\")\n  }\n}\n运行结果\nCompiled from \"Printable.scala\"\npublic abstract class Printable$class {\n  public static void print(Printable);\n  public static void $init$(Printable);\n}\nCompiled from \"Printable.scala\"\npublic abstract class Printable$class {\n  public static void print(Printable);\n  public static void $init$(Printable);\n}","title":"代码清单14-15"},{"location":"chapter-14/index.html#代码清单14-16","text":"public class APrintable implements Printable {\n  public void print() {\n    System.out.println(\"We can reuse the trait here if we like...\");\n    //Printable$class.print(this); // for 2.11.x\n    Printable.super.print(); // for 2.12.x\n  }\n  \n  public static void use(Printable printable) {\n    printable.print();\n  }\n  \n  public static void main(String[] args) {\n    APrintable aPrintable = new APrintable();\n    use(aPrintable);\n  }\n}\n运行结果\nWe can reuse the trait here if we like...\nrunning printable...","title":"代码清单14-16"},{"location":"chapter-14/index.html#代码清单14-17","text":"package chapter14\n\nobject Single {\n  def greet(): Unit = { println(\"Hello from Single\") }\n}","title":"代码清单14-17"},{"location":"chapter-14/index.html#代码清单14-18","text":"//Java code\npublic class SingleUser {\n  public static void main(String[] args) {\n    Single.greet();\n  }\n}","title":"代码清单14-18"},{"location":"chapter-14/index.html#代码清单14-19","text":"class Buddy {\n  def greet(): Unit = { println(\"Hello from Buddy class\") }\n}\n\nobject Buddy {\n  def greet(): Unit = { println(\"Hello from Buddy object\") }\n}","title":"代码清单14-19"},{"location":"chapter-14/index.html#代码清单14-20","text":"//Java code\npublic class BuddyUser {\n  public static void main(String[] args) {\n    new Buddy().greet();\n    Buddy$.MODULE$.greet(); \n  }\n}\n运行结果\nHello from Buddy class\nHello from Buddy object","title":"代码清单14-20"},{"location":"chapter-14/index.html#代码清单14-21","text":"abstract class BirdWithProblem {\n  def fly(): Unit\n  //...\n}","title":"代码清单14-21"},{"location":"chapter-14/index.html#代码清单14-22","text":"class Ostrich extends Bird {\n  override def fly(): Unit = {\n    throw new NoFlyException\n  }\n  //...\n}","title":"代码清单14-22"},{"location":"chapter-14/index.html#代码清单14-23","text":"class NoFlyException extends Exception {}","title":"代码清单14-23"},{"location":"chapter-14/index.html#代码清单14-24","text":"//Java code\nclass Penguin extends Bird {      \n  public void fly() throws NoFlyException {\n    throw new NoFlyException();\n  }\n  //...\n}\n运行结果\nPenguin.java:3: error: fly() in Penguin cannot override fly() in Bird\n  public void fly() throws NoFlyException {\n              ^\n  overridden method does not throw NoFlyException\n1 error","title":"代码清单14-24"},{"location":"chapter-14/index.html#代码清单14-25","text":"abstract class Bird {\n  @throws(classOf[NoFlyException]) def fly(): Unit\n  //...\n}","title":"代码清单14-25"},{"location":"chapter-15/index.html","text":"","title":"第15章——使用Scala创建应用程序 ·"},{"location":"chapter-15/index.html#第15章-使用scala创建应用程序","text":"","title":"第15章——使用Scala创建应用程序"},{"location":"chapter-15/index.html#代码清单15-1","text":"import scala.io._\n\nprint(\"Please enter a ticker symbol:\")\nval symbol = StdIn.readLine()\nprintln(s\"OK, got it, you own $symbol\")\n运行结果\nPlease enter a ticker symbol:OK, got it, you own AAPL","title":"代码清单15-1"},{"location":"chapter-15/index.html#代码清单15-2","text":"import java.io._\n\nval writer = new PrintWriter(new File(\"symbols.txt\"))\nwriter write \"AAPL\"\nwriter.close()\nprintln(scala.io.Source.fromFile(\"symbols.txt\").mkString)","title":"代码清单15-2"},{"location":"chapter-15/index.html#代码清单15-3","text":"import scala.io._\n\nprint(\"Please enter a ticker symbol:\")\nval symbol = StdIn.readLine()\nprintln(s\"OK, got it, you own $symbol\")\n运行结果\n*** The content of the file you read is:\nimport scala.io.Source\n\nprintln(\"*** The content of the file you read is:\")\nSource.fromFile(\"ReadingFile.scala\").foreach { print }","title":"代码清单15-3"},{"location":"chapter-15/index.html#代码清单15-4","text":"import scala.io.Source\nimport java.net.URL\n\nval source = Source.fromURL(new URL(\"http://localhost\"))\n\nprintln(s\"What's Source?: $source\")\nprintln(s\"Raw String: ${source.mkString}\")\n运行结果\nWhat's Source?: non-empty iterator\nRaw String: <html><body><h1>It works!</h1></body></html>","title":"代码清单15-4"},{"location":"chapter-15/index.html#代码清单15-5","text":"val xmlFragment =\n  <symbols>\n    <symbol ticker=\"AAPL\"><units>200</units></symbol>\n    <symbol ticker=\"IBM\"><units>215</units></symbol>\n  </symbols>\n\nprintln(xmlFragment)\nprintln(xmlFragment.getClass)\n运行结果\n<symbols>\n  <symbol ticker=\"AAPL\"><units>200</units></symbol>\n  <symbol ticker=\"IBM\"><units>215</units></symbol>\n</symbols>\nclass scala.xml.Elem","title":"代码清单15-5"},{"location":"chapter-15/index.html#代码清单15-6","text":"var symbolNodes = xmlFragment \\ \"symbol\"\nsymbolNodes foreach println\nprintln(symbolNodes.getClass)\n运行结果\n<symbol ticker=\"AAPL\"><units>200</units></symbol>\n<symbol ticker=\"IBM\"><units>215</units></symbol>\nclass scala.xml.NodeSeq$$anon$1","title":"代码清单15-6"},{"location":"chapter-15/index.html#代码清单15-7","text":"var unitsNodes = xmlFragment \\\\ \"units\"\nunitsNodes foreach println\nprintln(unitsNodes.getClass)\nprintln(unitsNodes.head.text)\n运行结果\n<units>200</units>\n<units>215</units>\nclass scala.xml.NodeSeq$$anon$1\n200","title":"代码清单15-7"},{"location":"chapter-15/index.html#代码清单15-8","text":"unitsNodes.head match {\n  case <units>{ numberOfUnits @ _* }</units> ⇒ println(s\"Units: $numberOfUnits\")\n}\n运行结果\nUnits: 200","title":"代码清单15-8"},{"location":"chapter-15/index.html#代码清单15-9","text":"println(\"Ticker\\tUnits\")\nxmlFragment match {\n  case <symbols>{ symbolNodes @ _* }</symbols> ⇒\n    for (symbolNode @ <symbol>{ _* }</symbol> ← symbolNodes) {\n      println(\"%-7s %s\".format(\n        symbolNode \\ \"@ticker\", (symbolNode \\ \"units\").text))\n    }\n}\n运行结果\nTicker\tUnits\nAAPL    200\nIBM     215","title":"代码清单15-9"},{"location":"chapter-15/index.html#代码清单15-10","text":"<symbols>\n  <symbol ticker=\"AAPL\"><units>200</units></symbol>\n  <symbol ticker=\"ADBE\"><units>125</units></symbol>\n  <symbol ticker=\"ALU\"><units>150</units></symbol>\n  <symbol ticker=\"AMD\"><units>150</units></symbol>\n  <symbol ticker=\"CSCO\"><units>250</units></symbol>\n  <symbol ticker=\"HPQ\"><units>225</units></symbol>\n  <symbol ticker=\"IBM\"><units>215</units></symbol>\n  <symbol ticker=\"INTC\"><units>160</units></symbol>\n  <symbol ticker=\"MSFT\"><units>190</units></symbol>\n  <symbol ticker=\"NSM\"><units>200</units></symbol>\n  <symbol ticker=\"ORCL\"><units>200</units></symbol>\n  <symbol ticker=\"SYMC\"><units>230</units></symbol>\n  <symbol ticker=\"TXN\"><units>190</units></symbol>\n  <symbol ticker=\"VRSN\"><units>200</units></symbol>\n  <symbol ticker=\"XRX\"><units>240</units></symbol>\n</symbols>","title":"代码清单15-10"},{"location":"chapter-15/index.html#代码清单15-11","text":"import scala.xml._\n\nval stocksAndUnits = XML load \"stocks.xml\"\nprintln(stocksAndUnits.getClass)\nprintln(s\"File has ${(stocksAndUnits \\\\ \"symbol\").size} symbol elements\")\n运行结果\nclass scala.xml.Elem\nFile has 15 symbol elements","title":"代码清单15-11"},{"location":"chapter-15/index.html#代码清单15-12","text":"val stocksAndUnitsMap =\n  (Map[String, Int]() /: (stocksAndUnits \\ \"symbol\")) { (map, symbolNode) ⇒\n    val ticker = (symbolNode \\ \"@ticker\").toString\n    val units = (symbolNode \\ \"units\").text.toInt\n    map + (ticker -> units) //return new map, with one additional entry\n  }\n\nprintln(s\"Number of symbol elements found is ${stocksAndUnitsMap.size}\")\n运行结果\nNumber of symbol elements found is 15","title":"代码清单15-12"},{"location":"chapter-15/index.html#代码清单15-13","text":"val updatedStocksAndUnitsXML =\n  <symbols>\n    { stocksAndUnitsMap map updateUnitsAndCreateXML }\n  </symbols>\n\ndef updateUnitsAndCreateXML(element: (String, Int)) = {\n  val (ticker, units) = element\n  <symbol ticker={ ticker }>\n    <units>{ units + 1 }</units>\n  </symbol>\n}\n\nXML save (\"stocks2.xml\", updatedStocksAndUnitsXML)\n\nval elementsCount = (XML.load(\"stocks2.xml\") \\\\ \"symbol\").size\nprintln(s\"Saved file has $elementsCount symbol elements\")\n运行结果\nSaved file has 15 symbol elements\n运行结果\nDate,Open,High,Low,Close,Volume,Adj Close\n2015-03-20,561.65,561.72,559.05,560.36,2585800,560.36\n2015-03-19,559.39,560.80,556.15,557.99,1191100,557.99\n2015-03-18,552.50,559.78,547.00,559.50,2124400,559.50\n...","title":"代码清单15-13"},{"location":"chapter-15/index.html#代码清单15-14","text":"import java.util.Calendar\n\nobject StockPriceFinder {\n  def getLatestClosingPrice(symbol: String): Double = {\n    val url = \"http://ichart.finance.yahoo.com/table.csv?s=\" +\n      symbol + \"&a=00&b=01&c=\" + Calendar.getInstance().get(Calendar.YEAR)\n    val data = scala.io.Source.fromURL(url).mkString\n    val mostRecentData = data.split(\"\\n\")(1)\n    val closingPrice = mostRecentData.split(\",\")(4).toDouble\n    closingPrice\n  }\n  def getTickersAndUnits: Map[String, Int] = {\n    val stocksAndUnitsXML = scala.xml.XML.load(\"stocks.xml\")\n    (Map[String, Int]() /: (stocksAndUnitsXML \\ \"symbol\")) {\n      (map, symbolNode) ⇒\n        val ticker = (symbolNode \\ \"@ticker\").toString\n        val units = (symbolNode \\ \"units\").text.toInt\n        map + (ticker -> units)\n    }\n  }\n}","title":"代码清单15-14"},{"location":"chapter-15/index.html#代码清单15-15","text":"object FindTotalWorthSequential extends App {\n  val symbolsAndUnits = StockPriceFinder.getTickersAndUnits\n\n  println(\"Ticker  Units  Closing Price($) Total Value($)\")\n\n  val startTime = System.nanoTime()\n  val valuesAndWorth = symbolsAndUnits.keys.map { symbol ⇒\n    val units = symbolsAndUnits(symbol)\n    val latestClosingPrice = StockPriceFinder getLatestClosingPrice symbol\n    val value = units * latestClosingPrice\n\n    (symbol, units, latestClosingPrice, value)\n  }\n\n  val netWorth = (0.0 /: valuesAndWorth) { (worth, valueAndWorth) ⇒\n    val (_, _, _, value) = valueAndWorth\n    worth + value\n  }\n  val endTime = System.nanoTime()\n\n  valuesAndWorth.toList.sortBy { _._1 }.foreach { valueAndWorth ⇒\n    val (symbol, units, latestClosingPrice, value) = valueAndWorth\n    println(f\"$symbol%7s  $units%5d  $latestClosingPrice%15.2f  $value%.2f\")\n  }\n\n  println(f\"The total value of your investments is $$$netWorth%.2f\")\n  println(f\"Took ${(endTime - startTime) / 1000000000.0}%.2f  seconds\")\n}\n运行结果\nTicker  Units  Closing Price($) Total Value($)\n   AAPL    200           125.90  25180.00\n   ADBE    125            77.36  9670.00\n    ALU    150             3.84  576.00\n    AMD    150             2.80  420.00\n   CSCO    250            28.44  7110.00\n    HPQ    225            33.28  7488.00\n    IBM    215           162.88  35019.20\n   INTC    160            31.31  5009.60\n   MSFT    190            42.88  8147.20\n    NSM    200            29.94  5988.00\n   ORCL    200            44.41  8882.00\n   SYMC    230            24.38  5607.40\n    TXN    190            59.28  11263.20\n   VRSN    200            64.75  12950.00\n    XRX    240            13.18  3163.20\nThe total value of your investments is $146473.80\nTook 11.13  seconds","title":"代码清单15-15"},{"location":"chapter-15/index.html#代码清单15-16","text":"val valuesAndWorth = symbolsAndUnits.keys.par.map { symbol ⇒\n运行结果\nTicker  Units  Closing Price($) Total Value($)\n   AAPL    200           125.90  25180.00\n   ADBE    125            77.36  9670.00\n    ALU    150             3.84  576.00\n    AMD    150             2.80  420.00\n   CSCO    250            28.44  7110.00\n    HPQ    225            33.28  7488.00\n    IBM    215           162.88  35019.20\n   INTC    160            31.31  5009.60\n   MSFT    190            42.88  8147.20\n    NSM    200            29.94  5988.00\n   ORCL    200            44.41  8882.00\n   SYMC    230            24.38  5607.40\n    TXN    190            59.28  11263.20\n   VRSN    200            64.75  12950.00\n    XRX    240            13.18  3163.20\nThe total value of your investments is $146473.80\nTook 1.98  seconds","title":"代码清单15-16"},{"location":"chapter-16/index.html","text":"","title":"第16章——单元测试 ·"},{"location":"chapter-16/index.html#第16章-单元测试","text":"","title":"第16章——单元测试"},{"location":"chapter-16/index.html#代码清单16-1","text":"import java.util\n\nimport org.junit.Assert._\nimport org.junit.Test\n\nclass UsingJUnit {\n  @Test\n  def listAdd(): Unit = {\n    val list = new util.ArrayList[String]\n    list.add(\"Milk\")\n    list add \"Sugar\"\n    assertEquals(2, list.size)\n  }\n}\n运行结果\nJUnit version 4.12\n.\nTime: 0.003\n\nOK (1 test)","title":"代码清单16-1"},{"location":"chapter-16/index.html#代码清单16-2","text":"import java.util\nimport org.scalatest._\n\nclass UsingScalaTest extends FlatSpec with Matchers {\n  trait EmptyArrayList {\n    val list = new util.ArrayList[String]\n  }\n\n  \"a list\" should \"be empty on create\" in new EmptyArrayList {\n    list.size should be(0)\n  }\n\n  \"a list\" should \"increase in size upon add\" in new EmptyArrayList {\n    list.add(\"Milk\")\n    list add \"Sugar\"\n\n    list.size should be(2)\n  }\n}\n运行结果\nRun starting. Expected test count is: 2\nUsingScalaTest:\na list\n- should be empty on create\na list\n- should increase in size upon add\nRun completed in 181 milliseconds.\nTotal number of tests run: 2\nSuites: completed 1, aborted 0\nTests: succeeded 2, failed 0, canceled 0, ignored 0, pending 0\nAll tests passed.","title":"代码清单16-2"},{"location":"chapter-16/index.html#代码清单16-3","text":"import org.scalatest.{ FlatSpec, Matchers }\n\nclass WordScorerTest extends FlatSpec with Matchers {\n\n  def withWordScorer(test: WordScorer ⇒ Unit): Unit = {\n    val wordScorer = new WordScorer()\n\n    test(wordScorer)\n  }\n\n  \"score\" should \"return 0 for an empty word\" in {\n    withWordScorer { wordScorer ⇒ wordScorer.score(\"\") should be(0) }\n  }\n\n  \"score\" should \"return 2 for word with two vowels\" in {\n    withWordScorer { _.score(\"ai\") should be(2) }\n  }\n\n  \"score\" should \"return 8 for word with four consonants\" in {\n    withWordScorer { _.score(\"myth\") should be(8) }\n  }\n\n  \"score\" should \"return 7 for word with a vowel and three consonants\" in {\n    withWordScorer { _.score(\"that\") should be(7) }\n  }\n}","title":"代码清单16-3"},{"location":"chapter-16/index.html#代码清单16-4","text":"class WordScorer() {\n  private val VOWELS = List('a', 'e', 'i', 'o', 'u')\n\n  def score(word: String): Int = {\n    (0 /: word) { (total, letter) ⇒\n      total + (if (VOWELS.contains(letter)) 1 else 2)\n    }\n  }\n}\n运行结果\nRun starting. Expected test count is: 4\nWordScorerTest:\nscore\n- should return 0 for an empty word\nscore\n- should return 2 for word with two vowels\nscore\n- should return 8 for word with four consonants\nscore\n- should return 7 for word that with a vowel and three consonants\nRun completed in 181 milliseconds.\nTotal number of tests run: 4\nSuites: completed 1, aborted 0\nTests: succeeded 4, failed 0, canceled 0, ignored 0, pending 0\nAll tests passed.","title":"代码清单16-4"},{"location":"chapter-16/index.html#代码清单16-5","text":"trait SpellChecker {\n  def isCorrect(word: String): Boolean\n}","title":"代码清单16-5"},{"location":"chapter-16/index.html#代码清单16-6","text":"import org.scalatest.{ FlatSpec, Matchers }\nimport org.mockito.Mockito._\nimport org.mockito.ArgumentMatchers.anyString\n\nclass WordScorerTest extends FlatSpec with Matchers {\n\n  def withWordScorer(test: WordScorer ⇒ Unit): Boolean = {\n    val spellChecker = mock(classOf[SpellChecker])\n    when(spellChecker.isCorrect(anyString)).thenReturn(true)\n    val wordScorer = new WordScorer(spellChecker)\n\n    test(wordScorer)\n\n    verify(spellChecker, times(1)).isCorrect(anyString())\n  }\n\n  //No change to the tests, same as in the previous version\n  \"score\" should \"return 0 for an empty word\" in {\n    withWordScorer { wordScorer ⇒ wordScorer.score(\"\") should be(0) }\n  }\n\n  \"score\" should \"return 2 for word with two vowels\" in {\n    withWordScorer { _.score(\"ai\") should be(2) }\n  }\n\n  \"score\" should \"return 8 for word with four consonants\" in {\n    withWordScorer { _.score(\"myth\") should be(8) }\n  }\n\n  \"score\" should \"return 7 for word that with a vowel and three consonants\" in {\n    withWordScorer { _.score(\"that\") should be(7) }\n  }\n\n}","title":"代码清单16-6"},{"location":"chapter-16/index.html#代码清单16-7","text":"class WordScorer(val spellChecker: SpellChecker) {\n  private val VOWELS = List('a', 'e', 'i', 'o', 'u')\n\n  def score(word: String): Int = {\n    spellChecker.isCorrect(word)\n    (0 /: word) { (total, letter) ⇒\n      total + (if (VOWELS.contains(letter)) 1 else 2)\n    }\n  }\n}\n运行结果\nRun starting. Expected test count is: 4\nWordScorerTest:\nscore\n- should return 0 for an empty word\nscore\n- should return 2 for word with two vowels\nscore\n- should return 8 for word with four consonants\nscore\n- should return 7 for word that with a vowel and three consonants\nRun completed in 316 milliseconds.\nTotal number of tests run: 4\nSuites: completed 1, aborted 0\nTests: succeeded 4, failed 0, canceled 0, ignored 0, pending 0\nAll tests passed.","title":"代码清单16-7"},{"location":"chapter-16/index.html#代码清单16-7","text":"\"score\" should \"return 0 for word with incorrect spelling\" in {\n  val spellChecker = mock(classOf[SpellChecker])\n  when(spellChecker.isCorrect(anyString)).thenReturn(false)\n  val wordScorer = new WordScorer(spellChecker)\n\n  wordScorer.score(\"aoe\") should be(0)\n  verify(spellChecker, times(1)).isCorrect(anyString())\n}","title":"代码清单16-7"},{"location":"chapter-16/index.html#代码清单16-8","text":"def score(word: String): Int = {\n  if (spellChecker.isCorrect(word))\n    (0 /: word) { (total, letter) ⇒\n      total + (if (VOWELS.contains(letter)) 1 else 2)\n    }\n  else\n    0\n}\n运行结果\nRun starting. Expected test count is: 5\nWordScorerTest:\nscore\n- should return 0 for an empty word\nscore\n- should return 2 for word with two vowels\nscore\n- should return 8 for word with four consonants\nscore\n- should return 7 for word that with a vowel and three consonants\nscore\n- should return 0 for word with incorrect spelling\nRun completed in 208 milliseconds.\nTotal number of tests run: 5\nSuites: completed 1, aborted 0\nTests: succeeded 5, failed 0, canceled 0, ignored 0, pending 0\nAll tests passed.","title":"代码清单16-8"},{"location":"appendix-02/index.html","text":"","title":"附录 2"},{"location":"appendix-02/index.html#附录-2","text":"TODO","title":"附录 2"}]}